---
import { getCollection } from 'astro:content';

interface Props {
  currentPath?: string;
}

const { currentPath = '' } = Astro.props;

const docs = await getCollection('docs', ({ data }) => !data.draft);

// Group docs by section
const sections: Record<string, typeof docs> = {};
docs.forEach((doc) => {
  const section = doc.data.section;
  if (!sections[section]) {
    sections[section] = [];
  }
  sections[section].push(doc);
});

// Sort each section by order
Object.keys(sections).forEach((section) => {
  sections[section].sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
});

// Define section order and display names
const sectionConfig: Record<string, { order: number; label: string }> = {
  'getting-started': { order: 1, label: 'Getting Started' },
  'theming': { order: 2, label: 'Theming' },
  'input': { order: 10, label: 'Input' },
  'feedback': { order: 20, label: 'Feedback' },
  'navigation': { order: 30, label: 'Navigation' },
  'surfaces': { order: 40, label: 'Surfaces' },
  'data-display': { order: 50, label: 'Data Display' },
  'components': { order: 60, label: 'Components' },
  'api': { order: 70, label: 'API' },
};

const sortedSections = Object.keys(sections).sort((a, b) => {
  return (sectionConfig[a]?.order || 999) - (sectionConfig[b]?.order || 999);
});

function isActive(slug: string): boolean {
  return currentPath === `/docs/${slug}` || currentPath === `/docs/${slug}/`;
}
---

<nav class="nav" aria-label="Documentation navigation">
  {sortedSections.map((section) => (
    <div class="nav-section">
      <h3 class="nav-section-title">{sectionConfig[section]?.label || section}</h3>
      <ul class="nav-list">
        {sections[section].map((doc) => (
          <li class="nav-item">
            <a
              href={`/duskmoon-elements/docs/${doc.slug}`}
              class:list={['nav-link', { active: isActive(doc.slug) }]}
              aria-current={isActive(doc.slug) ? 'page' : undefined}
            >
              {doc.data.title}
            </a>
          </li>
        ))}
      </ul>
    </div>
  ))}
</nav>

<style>
  .nav {
    padding: 1rem 0;
  }

  .nav-section {
    margin-bottom: 1.5rem;
  }

  .nav-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-on-surface);
    opacity: 0.6;
    margin: 0 0 0.5rem 0;
    padding: 0 1rem;
  }

  .nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-item {
    margin: 0;
  }

  .nav-link {
    display: block;
    padding: 0.5rem 1rem;
    color: var(--color-on-surface);
    text-decoration: none;
    font-size: 0.875rem;
    border-left: 2px solid transparent;
    transition: all 0.15s ease;
  }

  .nav-link:hover {
    background-color: var(--color-surface-container);
    color: var(--color-primary);
  }

  .nav-link.active {
    background-color: var(--color-primary-container);
    color: var(--color-primary);
    border-left-color: var(--color-primary);
    font-weight: 500;
  }
</style>
